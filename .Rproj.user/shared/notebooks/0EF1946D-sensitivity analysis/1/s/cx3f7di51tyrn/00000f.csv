"0","# Simulation Parameters"
"0","sample_sizes <- seq(30, 80, by = 5) # Test N from 30 to 80"
"0","nsim <- 1000 # Number of simulations per sample size"
"0","sd_acc <- 0.2 # Estimated standard deviation for accuracy"
"0","alpha <- 0.05 # Significance level"
"0",""
"0","# Run the simulation loop"
"0","power_results_acc <- sapply(sample_sizes, function(n) {"
"0","  significant_results <- 0"
"0","  for (i in 1:nsim) {"
"0","    # FIX: Correctly structure the long-format data for repeated measures"
"0","    sim_data <- tibble("
"0","      id = factor(rep(1:n, each = 18)),"
"0","      sound = factor(rep(c(""Looming"", ""Stationary"", ""No_Sound""), each = 6, times = n)),"
"0","      location = factor(rep(c(""Center"", ""Periphery""), each = 3, times = 3 * n)),"
"0","      difficulty = factor(rep(rep(1:3, each = 1), times = 6 * n)),"
"0","      accuracy = rnorm(n * 18, mean = rep(mu_vector_acc, times = n), sd = sd_acc)"
"0","    )"
"0","    "
"0","    # Run the ANOVA"
"0","    model_anova <- suppressMessages(aov_4(accuracy ~ sound * location * difficulty + (sound * location * difficulty | id), data = sim_data))"
"0","    "
"0","    # Check for significance of the 3-way interaction"
"0","    p_value <- summary(model_anova)$anova_table$`Pr(>F)`[7] # 7th row is the 3-way interaction"
"0","    if (!is.na(p_value) && p_value < alpha) {"
"0","      significant_results <- significant_results + 1"
"0","    }"
"0","  }"
"0","  significant_results / nsim"
"0","})"
"2","Error in if (!is.na(p_value) && p_value < alpha) { : 
  missing value where TRUE/FALSE needed
"
